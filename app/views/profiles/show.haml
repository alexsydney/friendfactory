- stylesheet 'profiles'
- javascript 'wave'

.wave[@wave]
  .grid_3.sidebar
    = spinner :id => 'posting_avatar_spinner', :size => :big
    = render :partial => 'avatars/portrait', :object => @wave.avatar, :locals => { :online_badge => false }
    = render :partial => 'user_info/show', :object => @wave.user.info
    &nbsp;
  .grid_12
    - if @wave.user == current_user
      #tabs
        %ul
          %li
            %a{:href => "#avatar"} Avatar
          %li
            %a{:href => "#about"} About Me
          %li
            %a{:href => "#text"} Text
          %li
            %a{:href => "#photos"} Photos
          %li
            %a{:href => "#buddies"} Buddies
          %li.ajax
            %a{:href => "#links"} Links
      - content_for :pagejs do
        :plain
          $('#tabs li:eq(0)').click(function(event) {
            $('.sidebar .posting').hide();
          });

          $('#tabs li').not('#tabs li:eq(0)').click(function(event) {
            $('.sidebar .posting').show();
          });

          $('#tabs li:eq(0)').button({ icons: { primary: 'ui-icon-person' }})
          $('#tabs li:eq(1)').button({ icons: { primary: 'ui-icon-script' }});
          $('#tabs li:eq(2)').button({ icons: { primary: 'ui-icon-pencil' }});
          $('#tabs li:eq(3)').button({ icons: { primary: 'ui-icon-image' }});
          $('#tabs li:eq(4)').button({ icons: { primary: 'ui-icon-heart' }});
          $('#tabs li:eq(5)').button({ icons: { primary: 'ui-icon-link' }});

    - elsif current_user
      #tabs
        %ul
          %li
            %a{:href => "#text"} Text
          %li
            %a{:href => "#photos"} Photo
      - content_for :pagejs do
        :plain
          $('#tabs li:eq(0)').button({ icons: { primary: 'ui-icon-pencil' }});
          $('#tabs li:eq(1)').button({ icons: { primary: 'ui-icon-image' }});

    %h1
      #{@wave.user.first_name}&#8217;s Wave

    - if @wave.user == current_user
      #avatar.tab_content
        %h2 Upload an Avatar        
        = render :partial => 'avatars/edit', :locals => { :online_badge => false }
        = render :partial => 'avatars/form'
        - content_for :pagejs do
          :plain
            $('form#new_posting_avatar').submit(function(){   
              $(this).closest('.tab_content').hide();
              $('#posting_avatar_spinner').show();
            })
            .find('button.cancel').click(function(event){
              event.preventDefault();              
              $('.sidebar .posting').show();
            });
        
    - if @wave.user == current_user
      #about.tab_content
        = render :partial => 'user_info/edit'
        
    - if current_user
      #text.tab_content
        %h2
          Write a Message on
          = (@wave.user == current_user) ? "your" : "#{@wave.user.first_name}&#8217;s"
          Wave

    - if current_user
      #photos.tab_content
        %h2
          Upload a Photo to
          = (@wave.user == current_user) ? "your" : "#{@wave.user.first_name}&#8217;s"
          Wave
        - form_for Posting::Photo::new, :url => profile_photos_path(:profile_id => @wave.user.profile, :format => :js), :html => { :multipart => true, :target => 'upload_frame' } do |f|
          #photo_upload_error.hidden
          #photo_upload_well.append-bottom.clearfix
            =# render :partial => 'photos/edit', :collection => @wave.user.profile.photos
          .button_bar
            = f.file_field :image
            = f.submit 'Upload', :id => 'photo_upload_submit'
            = f.button :Cancel, :class => 'cancel'
            = spinner

    - if @wave.user == current_user
      #buddies.tab_content
        %h3= @wave.user.first_name + '&#8217;s Buddies'

    - if @wave.user == current_user
      #links.tab_content
        %h3 Links

    %iframe#upload_frame{:height => "1", :name => "upload_frame", :src => "about:blank", :style => "border:0px", :width => "1"}
    
    - if @wave.postings.exclude(Posting::Avatar).empty?
      .postings.empty
        %h3
          - if @wave.user == current_user
            You'll want to meet new friends, right? Put something on your wave! 
          - else
            = @wave.user.first_name
            hasn't done anything with their wave.
            - if current_user
              Put something here for them!
    - else
      .postings
        = render :partial => 'postings/posting', :collection => @wave.postings.exclude(Posting::Avatar)

  .grid_1
    &nbsp;

- content_for :pagejs do
  :plain
    $('div.tab_content').hide();
    $('.tab_content button.cancel').click(function(event){
      event.preventDefault();
      $(this).closest('.tab_content').hide();
    });

    $('#tabs li a').click(function(event) {
      event.preventDefault();
      $($(this).attr('href')).show().siblings('div.tab_content').hide();
    });
