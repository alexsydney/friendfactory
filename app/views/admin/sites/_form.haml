%script#biometric_domain-template{:type => "text/x-jquery-tmpl"}
  .biometric_domain
    <input id="site_biometric_domains_attributes_${ domainSeq }_display_name" name="site[biometric_domains_attributes][${ domainSeq }][display_name]" placeholder="name" size="30" type="text" value="">
    .domain_value
      <select id="site_biometric_domains_attributes_${ domainSeq }_domain_values_attributes_signal_id" name="site[biometric_domains_attributes][${ domainSeq }][domain_values_attributes][signal_id][]">
      = options_for_select([[ '', nil ]] + Biometric::Value.all.collect {|v| [ v.name, v.id ] })
      </select>
    <button class="add" id="new_domain_value">Add Value</button>

%script#domain_value-template{:type => "text/x-jquery-tmpl"}
  .domain_value
    <select id="site_biometric_domains_attributes_${ domainSeq }_domain_values_attributes_signal_id" name="site[biometric_domains_attributes][${ domainSeq }][domain_values_attributes][signal_id][]">
    = options_for_select([[ '', nil ]] + Biometric::Value.all.collect {|v| [ v.name, v.id ] })
    </select>

= form_for([ :admin, site_with_empty_fields(@site) ], :html => { :multipart => true }) do |f|
  %table.form
    %tr
      %td
        = f.label :name, 'Name in Url'
        %br/
        %span.unobtrusive
          Name of the site in the url
      %td
        = f.text_field :name, :placeholder => 'Lower case only, no spaces'
        = f.error_message_on :name
    %tr
      %td
        = f.label :display_name
        %br/
        %span.unobtrusive
          Site's full human-readable name
      %td
        = f.text_field :display_name, :placeholder => 'Site Name'
        = f.error_message_on :display_name
    %tr
      %td
        = f.label :mailer, 'Mailer email address'
        %br/
        %span.unobtrusive
          Sender and Reply-to email address
      %td
        = f.text_field :mailer, :placeholder => 'mailer@friskyfactory.com'
        = f.error_message_on :mailer
    %tr
      %td
        = f.label :analytics_domain_name
        %br/
        %span.unobtrusive
          Copy from Google analytics
      %td
        = f.text_field :analytics_domain_name, :placeholder => '.excellent-site.com'
        = f.error_message_on :analytics_domain_name
    %tr
      %td
        = f.label :analytics_account_number
        %br/
        %span.unobtrusive
          Copy from Google analytics
      %td
        = f.text_field :analytics_account_number, :placeholder => 'UA-xxxxxxxx-x'
        = f.error_message_on :analytics_account_number
    %tr.biometrics
      %td
        %label Biometrics
      %td
        - @site.biometric_domains.each_with_index do |domain, idx|
          = f.fields_for :biometric_domains, domain do |biometric_form|
            .biometric_domain
              = biometric_form.text_field :display_name, :placeholder => 'name'
              - unless biometric_form.object.new_record?
                = biometric_form.check_box('_destroy')
                = biometric_form.label('_destroy', 'Remove')
              - biometric_form.object.domain_values.each do |domain_value|
                .domain_value
                  = select_tag "site[biometric_domains_attributes][#{idx}][domain_values_attributes][signal_id][]", options_for_select([[ '', nil ]] + Biometric::Value.all.collect {|v| [ v.name, v.id ] }, domain_value.value_id)
              = button_tag 'Add Value', :id => 'new_domain_value', :class => 'add'
        = button_tag 'Add Another Biometric', :id => 'new_domain', :class => 'add'

    %tr.stylesheet
      %td
        =f.label :css, 'Stylesheet'
      %td
        = f.fields_for :stylesheets do |stylesheet_form|
          .fields
            = stylesheet_form.text_field :controller_name, :placeholder => 'controller name', :class => 'stylesheet_controller_name'
            = stylesheet_form.check_box('_destroy')
            = stylesheet_form.label('_destroy', 'Remove')
            = stylesheet_form.text_area :css, :placeholder => 'css or scss', :class => 'stylesheet_css'
          = stylesheet_form.button 'Add Another Stylesheet', :id => 'new_stylesheet' # , :class => 'hidden'

    %tr.assets.constants
      %td
        = f.label :constants
        %br/
        %span.instruction
          Available in SCSS as $name
      %td
        .table
          = f.fields_for :constants do |asset_form|
            .tr.asset.constant
              .td
                = asset_form.text_field :name, :placeholder => 'name'
              .td
                = asset_form.text_field :value, :placeholder => 'value'
              - if asset_form.object.new_record?
                .td
                  = button_tag 'Add', :class => 'add asset'
              - else
                .td
                  = asset_form.check_box('_destroy')
                  = asset_form.label('_destroy', 'Remove')

    %tr.assets.texts
      %td
        = f.label :text
      %td
        .table
          = f.fields_for :texts do |asset_form|
            .tr.asset.text
              .td
                = asset_form.text_field :name, :placeholder => 'name'
              .td
                = asset_form.text_field :value, :placeholder => 'value'
              - if asset_form.object.new_record?
                .td
                  = button_tag 'Add', :class => 'add asset'
              - else
                .td
                  = asset_form.check_box('_destroy')
                  = asset_form.label('_destroy', 'Remove')

    %tr.assets.images
      %td
        = f.label :images
        %br/
        %span.instruction
          Available in SCSS as $name
      %td
        .table
          = f.fields_for :images do |asset_form|
            .tr.asset.image
              - if asset_form.object.new_record?
                .td.silhouette= image_tag 'friskyfactory/silhouette-q.gif', :size => '32x32', :site => false
                .td
                  = asset_form.text_field :name, :placeholder => 'name'
                  = asset_form.file_field :asset
                .td &nbsp;
              - else
                .td= image_tag asset_form.object.asset.url(:thumb), :site => false
                .td= asset_form.text_field :name, :placeholder => 'name'
                .td
                  = asset_form.check_box('_destroy')
                  = asset_form.label('_destroy', 'Remove')
    %tr
      %td &nbsp;
      %td
        = f.check_box :launch
        = f.label :launch, "&#8220;Coming Soon&#8221; launch page".html_safe
    %tr
      %td &nbsp;
      %td
        = f.check_box :invite_only
        = f.label :invite_only, 'Requires an invitation to join'

  .button-bar.footer
    = f.submit 'Save', :button => true
    = link_to 'Cancel', admin_sites_path, :class => 'button cancel'
